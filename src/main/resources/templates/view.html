<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${post.title}">–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å—Ç–∞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #fafafa;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        .navbar {
            background-color: #fff;
            border-bottom: 1px solid #dbdbdb;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        .logo-text {
            font-weight: 700;
            font-size: 28px;
            background: linear-gradient(45deg, #f58529, #dd2a7b, #8134af, #515bd4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            user-select: none;
        }

        .post-card {
            background-color: white;
            border: 1px solid #dbdbdb;
            border-radius: 10px;
            overflow: hidden;
            max-width: 700px;
            margin: 30px auto;
        }

        .carousel-item img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        .post-content {
            padding: 20px;
        }

        .comment-preview {
            font-size: 14px;
            color: #555;
            margin-top: 8px;
        }

        .comment-preview span {
            font-weight: 500;
            color: #000;
        }

        .btn-add {
            background: linear-gradient(45deg, #f58529, #dd2a7b, #8134af);
            border: none;
            color: white;
            border-radius: 10px;
            font-weight: 600;
            transition: 0.3s;
        }

        .btn-add:hover {
            opacity: 0.9;
        }

        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            filter: invert(1);
        }

        .comment-form textarea {
            resize: none;
        }

        /* ‚ù§Ô∏è –õ–∞–π–∫–∏ */
        #like-btn {
            font-size: 26px;
            background: none;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        #like-btn.liked {
            color: #e1306c;
            transform: scale(1.2);
        }
        #like-count {
            font-weight: 600;
            font-size: 18px;
            margin-left: 5px;
        }
    </style>
</head>
<body>

<!-- üîπ –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
<nav class="navbar navbar-light justify-content-between px-4 py-2">
    <a href="/" class="logo-text text-decoration-none">EGOROV'S&nbsp;BLOG</a>
    <div>
        <a th:href="@{'/posts/edit/' + ${post.id}}" class="btn btn-sm btn-outline-primary me-2">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a th:href="@{'/posts/delete/' + ${post.id}}" class="btn btn-sm btn-outline-danger"
           onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç?')">üóë –£–¥–∞–ª–∏—Ç—å</a>
    </div>
</nav>

<!-- üîπ –ü–æ—Å—Ç -->
<div class="post-card shadow-sm">
    <!-- ‚úÖ –ö–∞—Ä—É—Å–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
    <div th:if="${post.images != null and !post.images.isEmpty()}">
        <div th:id="'carouselPost' + ${post.id}" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div th:each="image, iterStat : ${post.images}" class="carousel-item"
                     th:classappend="${iterStat.index == 0} ? ' active'">
                    <img th:src="@{'/images/' + ${image.id}}" alt="image" class="d-block w-100">
                </div>
            </div>

            <button class="carousel-control-prev" type="button"
                    th:attr="data-bs-target='#carouselPost' + ${post.id}" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button"
                    th:attr="data-bs-target='#carouselPost' + ${post.id}" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
    </div>

    <!-- –ï—Å–ª–∏ –Ω–µ—Ç –∫–∞—Ä—Ç–∏–Ω–æ–∫ -->
    <div th:if="${post.images == null or post.images.isEmpty()}">
        <img th:if="${post.previewImageId != null}" th:src="@{'/images/' + ${post.previewImageId}}" alt="preview" class="w-100">
    </div>

    <!-- –¢–µ–∫—Å—Ç -->
    <div class="post-content">
        <h3 th:text="${post.title}"></h3>
        <p class="text-muted" th:text="'–ê–≤—Ç–æ—Ä: ' + (${post.author != null ? post.author.username : '–ì–æ—Å—Ç—å'})"></p>
        <p th:text="${post.content}"></p>

        <!-- ‚ù§Ô∏è –õ–∞–π–∫–∏ -->
        <div class="d-flex align-items-center mt-3">
            <button id="like-btn" th:data-id="${post.id}">‚ù§Ô∏è</button>
            <span id="like-count" th:text="${post.likes}">0</span>
        </div>
    </div>

    <!-- üîπ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
    <div class="px-4 pb-4">
        <h5 class="mt-3 mb-3">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h5>
        <div th:if="${comments != null and !comments.isEmpty()}">
            <div th:each="comment : ${comments}" class="comment-preview border-bottom pb-2 mb-2">
                <span th:text="${comment.author != null ? comment.author.username : '–ì–æ—Å—Ç—å'}"></span>:
                <span th:text="${comment.text}"></span>
            </div>
        </div>
        <div th:if="${comments == null or comments.isEmpty()}">
            <p class="text-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
        </div>

        <!-- üîπ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
        <form class="comment-form mt-3" th:action="@{'/comments/add/' + ${post.id}}" method="post">
            <textarea class="form-control mb-2" name="text" rows="2" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
            <button class="btn btn-add w-100" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
    </div>
</div>

<!-- üîπ Bootstrap + JS –¥–ª—è –ª–∞–π–∫–æ–≤ -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const likeBtn = document.getElementById("like-btn");
        const likeCount = document.getElementById("like-count");

        likeBtn.addEventListener("click", async () => {
            const postId = likeBtn.dataset.id;
            likeBtn.classList.toggle("liked");

            const response = await fetch(`/posts/like/${postId}`, { method: "POST" });

            if (response.ok) {
                const newLikes = await response.text();
                likeCount.textContent = newLikes;
            } else {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ª–∞–π–∫–∞ üò¢");
            }
        });
    });
</script>

</body>
</html>

