<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'Профиль — ' + ${user.username}">Профиль</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        body {
            background: #fafafa;
            font-family: 'Segoe UI', Roboto, Arial, sans-serif;
        }

        .profile-header {
            max-width: 900px;
            margin: 30px auto;
            background: white;
            border-radius: 10px;
            border: 1px solid #dbdbdb;
            padding: 25px;
        }

        .avatar {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #ddd;
        }

        .username {
            font-size: 26px;
            font-weight: 600;
        }

        .edit-btn {
            border-radius: 10px;
            font-weight: 600;
        }

        .posts-grid {
            max-width: 900px;
            margin: 20px auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .post-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            background: white;
        }

        .post-card img {
            width: 100%;
            height: 220px;
            object-fit: cover;
        }

        .post-title {
            padding: 10px;
            font-size: 18px;
            font-weight: 500;
        }
    </style>
</head>

<body>

<!-- Навбар -->
<nav class="navbar navbar-light px-4 py-2" style="background:#fff;border-bottom:1px solid #ddd;">
    <a class="logo-text text-decoration-none" href="/" style="
        font-weight:700;font-size:28px;
        background:linear-gradient(45deg,#f58529,#dd2a7b,#8134af,#515bd4);
        -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    ">EGOROV'S BLOG</a>

    <div class="d-flex align-items-center gap-3">
        <a href="/" class="btn btn-outline-secondary btn-sm">⬅ На главную</a>

        <!-- logout -->
        <form th:action="@{/logout}" method="post" class="m-0">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button class="btn btn-outline-danger btn-sm">Выйти</button>
        </form>
    </div>
</nav>

<!-- Профиль -->
<div class="profile-header d-flex align-items-center gap-4">

    <img th:if="${user.avatar != null}" th:src="@{'/profile/avatar/' + ${user.id}}" class="avatar">
    <img th:if="${user.avatar == null}" src="/images/default-avatar.png" class="avatar">


    <div>
        <h1 th:if="${user != null}" th:text="${user.username}">Username</h1>
        <div class="text-muted" th:text="${user.email}"></div>

        <div class="mt-2">
            <span class="fw-semibold">Постов:</span>
            <span th:text="${posts.size()}">0</span>
        </div>

        <!-- редактирование профиля — только если это наш аккаунт -->
        <div class="mt-3"
             th:if="${#authentication != null and #authentication.name == user.username}">
            <a href="/profile/edit" class="btn btn-primary edit-btn btn-sm">Редактировать профиль</a>
        </div>

    </div>
</div>

<!-- Посты пользователя -->
<h3 class="text-center mt-4 mb-3">Посты пользователя</h3>

<div class="posts-grid">

    <div th:each="post : ${posts}" class="post-card">

        <a th:href="@{'/posts/view/' + ${post.id}}">
            <!-- картинка -->
            <img th:if="${post.previewImageId != null}"
                 th:src="@{'/images/' + ${post.previewImageId}}">

            <!-- если нет картинки -->
            <img th:if="${post.previewImageId == null}"
                 src="/images/default-post.png">
        </a>

        <div class="post-title" th:text="${post.title}"></div>
    </div>

</div>

</body>
</html>
